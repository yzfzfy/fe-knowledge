# 安全、隐私

## xss 攻击

全称 Cross site scripting 跨站脚本攻击，是指浏览器中执行恶意脚本，无论跨域还是同域，从而拿到用户的信息并进行操作。
这些危险的操作一般包括：窃取 cookie、监听用户行为（输入账号后发往黑客服务器）、修改 dom 伪造登录表单、生成浮窗广告。这些操作实现的方式一般分为三类：存储型、反射型、文档型。

1. 存储型。顾名思义就是将恶意脚本存储起来到服务端，随后在客户端执行。常见的就是在评论区输入一段脚本代码，如果前后端都没有做好转义，那么经服务端再返回客户端渲染时，浏览器会直接执行这段未知逻辑代码。因为服务端存储过恶意脚本，所以只要打开评论内容的用户都可能会被攻击，影响范围比较广。
2. 反射型。与存储型的区别就是服务端没有存储脚本，而是被浏览器当作 html 文本直接展示在了页面中。常见的就是 url 中有对应参数值被直接展示在页面中，攻击者需要伪造链接中的参数以执行攻击。
3. 文档型。文档型的不会经过服务端，而是作为中间人的角色，在数据传输过程中劫持到网络数据包，修改其中的 html 文档添加恶意脚本。这样的劫持方式包括 WIFI 路由器劫持或者本地恶意软件等。

### 如何防范

从攻击生效方式看，都是在浏览器中直接执行了恶意脚本。要防范要做到如下几点

1. 不能相信任何用户的输入，防止用户输入脚本代码。具体可能需要转码或删除输入中的 script 标签，有时候可能攻击者还会使用其他标签
2. 利用 HttpOnly。很多攻击会窃取 Cookie，而设置 Cookie 的 HttpOnly 属性后，通过 js 就无法获取 Cookie 的值，
3. 利用 CSP。//TODO 内容安全策略。它的核心思想就是服务器决定浏览器加载哪些资源，具体来说可以完成以下功能:

限制其他域下的资源加载。
禁止向其它域提交数据。
提供上报机制，能帮助我们及时发现 XSS 攻击。

## CSRF 攻击

CSRF(Cross-site request forgery), 即跨站请求伪造，指的是黑客诱导用户点击链接，打开黑客的网站，然后黑客利用用户目前的登录状态发起跨站请求。相比于 xss 攻击，它不需要注入恶意代码到用户页面中，只需要诱导用户打开未知链接，即可由未知页面发起对与安全接口的请求，而安全接口无法判断出该请求是否由本人发起。

具体过程可能是
其中 Web A 为存在 CSRF 漏洞的网站，Web B 为攻击者构建的恶意网站，User C 为 Web A 网站的合法用户。

1. 用户 C 打开浏览器，访问受信任网站 A，输入用户名和密码请求登录网站 A；

2.在用户信息通过验证后，网站 A 产生 Cookie 信息并返回给浏览器，此时用户登录网站 A 成功，可以正常发送请求到网站 A；

3. 用户未退出网站 A 之前，在同一浏览器中，打开一个 TAB 页访问网站 B；

4. 网站 B 接收到用户请求后，返回一些攻击性代码，并发出一个请求要求访问第三方站点 A；

5. 浏览器在接收到这些攻击性代码后，根据网站 B 的请求，在用户不知情的情况下携带 Cookie 信息，向网站 A 发出请求。网站 A 并不知道该请求其实是由 B 发起的，所以会根据用户 C 的 Cookie 信息以 C 的权限处理该请求，导致来自网站 B 的恶意代码被执行。

### 如何防范

1. 该攻击都会用到登录信息，所以防止 cookie 不被正确的发送到接口即可，cookie 中的 SameSite 字段可以使用，该字段有三个值，Strict、Lax、None  
   a. 在 Strict 模式下，浏览器完全禁止第三方请求携带 Cookie。比如请求 sanyuan.com 网站只能在 sanyuan.com 域名当中请求才能携带 Cookie，在其他网站请求都不能。

b. 在 Lax 模式，就宽松一点了，但是只能在 get 方法提交表单况或者 a 标签发送 get 请求的情况下可以携带 Cookie，其他情况均不能。

c. 在 None 模式下，也就是默认模式，请求会自动携带上 Cookie。

2. 验证来源站点

用到请求头的两个字段：origin?/host 和 referer。但是这些字段可以伪造，只要发请求时在请求头中添加即可。

3. CSRF Token

首先，浏览器向服务器发送请求时，服务器生成一个字符串，将其植入到返回的页面中。

然后浏览器如果要发送请求，就必须带上这个字符串，然后服务器来验证是否合法，如果不合法则不予响应。这个字符串也就是 CSRF Token，通常第三方站点无法拿到这个 token, 因此也就是被服务器给拒绝。

## HTTPS 为什么让数据传输更安全？

谈到 HTTPS, 就不得不谈到与之相对的 HTTP。HTTP 的特性是明文传输，因此在传输的每一个环节，数据都有可能被第三方窃取或者篡改，具体来说，HTTP 数据经过 TCP 层，然后经过 WIFI 路由器、运营商和目标服务器，这些环节中都可能被中间人拿到数据并进行篡改，也就是我们常说的中间人攻击。

HTTPS 并不是一个新的协议, 而是一个加强版的 HTTP。其原理是在 HTTP 和 TCP 之间建立了一个中间层，当 HTTP 和 TCP 通信时并不是像以前那样直接通信，直接经过了一个中间层进行加密，将加密后的数据包传给 TCP, 响应的，TCP 必须将数据包解密，才能传给上面的 HTTP。这个中间层也叫安全层。安全层的核心就是对数据加解密。利用对称加密和非对称机密结合数字证书认证的方式，让传输过程的安全性大大提高。

## 参考链接

-   [如何实施一次 xss 攻击](https://zhuanlan.zhihu.com/p/91437488)
