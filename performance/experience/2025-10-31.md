# hox 库问题

hox 保存很多页面上的全局状态时，如果其中某一个数据改变后，setState 执行更新页面。页面上用到 hox 中状态的 UI 部分好像都会更新，一次性更新的页面状态过多，导致所有 UI 组件更新都有延迟，页面渲染卡顿。

此时如果将某个状态提取到外边，不使用 hox。那么用到这个状态的 UI 更新比其他还在 hox 中的状态的对应 UI 更新要快。

```js
const getData = async (params) => {
  setLoading(false);
  const res = await get24HStationOutageNum(params);
  if (res.code === 200) {
    if (isSpecialProvince(province.code)) {
      if (city.name) {
        setRankingList(
          res.data.dateList.filter((e) => e.areaName.indexOf(city.name) > -1)
        );
      } else {
        setRankingList([...res.data.dateList]);
      }
    } else {
      if (areaLevel === "county" || areaLevel === "city") {
        const selCounty = res.data.dateList.find(
          (e) => e.areaName === county.name
        );
        if (selCounty) {
          setRankingList([selCounty]);
        } else {
          setRankingList(
            res.data.dateList.filter(
              (e) => e.areaName.indexOf(county.name) > -1
            )
          );
        }
      } else {
        setRankingList([...res.data.dateList]);
      }
    }
    setCombineStationData({
      indicatorList: res.data.dataMap?.indicatorList || [],
    });
    setLoading(false);
  }
};
```

上方代码中，`setRankingList`是某个 UI 组件（A）内部的 setState,`setCombineStationData`是 hox 中导出的方法（B 组件用到）。当接口返回数据更新页面时，发现 A 和 B 页面更新慢，感觉有延迟。此时尝试将`setCombineStationData`注释掉，发现 A 组件更新很快，发现了是由于`setCombineStationData`导致的更新慢。所以将`setCombineStationData`从 hox 中提取到了 B 组件的内部，然后 A 组件和 B 组件的渲染都快了。

分析：hox 中的状态太多，更新一个状态时，猜测未改变的状态的 UI 也执行了渲染，一次性渲染过多导致数据更新延迟。
