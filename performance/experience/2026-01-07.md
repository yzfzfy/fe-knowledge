# 超大分辨率显示器大屏闪屏/白屏问题

## 问题描述

现场用户报告问题，在打开页面没有完全加载完成时，整个页面白屏闪了一下，然后页面显示，但是页面中地图和图表的部分显示空白。

## 问题分析
去到用户现场发现，这个现象不稳定，用户使用的是超大分辨率显示器，15k显示器。在另一个8k的显示器上虽然也会出现，但是明显出现的概率要低很多。

据其他做大屏的团队的经验说，在渲染地图时需要设置渲染的dpr为1。理由是设置为1后，地图渲染的点少，gpu压力小。

根据提供的经验确定大致方向，查阅资料，大概原因，地图或echarts等使用canvas渲染的页面元素过大导致gpu显存过载，机器强制重置gpu显存，页面渲染暂停，导致屏闪后页面才稳定且echarts元素渲染失败。

为什么设置dpr为1后，地图渲染的点少，gpu压力小？


比如显示器设置为8k， 8160*2430，缩放比例为200%，假如页面canvas元素占满全屏，canvas元素的宽度和高度为8160*2430，但是缩放比例是2，相当于设置了dpr为2（echarts默认取当前设置的window.devicePixelRatio），那么canvas元素的渲染点数为8160*2=16320，多了一倍，增加了gpu压力。取当前设备的dpr的原因是为了设置更清晰的显示。

设置方式：
百度地图：window.BMAPGL_FORCE_RATIO = 1;
echarts：echarts.init(document.getElementById('main'),{ devicePixelRatio: 1 });

基于canvas元素会给gpu带来很大的压力，查阅echarts文档后，发现官方支持设置renderer为svg，关于renderer采用canvas和svg的区别[参考](https://echarts.apache.org/handbook/zh/best-practices/canvas-vs-svg/)，概括为就是svg的内存占用更低。如果发现浏览器崩溃的情况，且不影响渲染效果时，可以尝试设置renderer为svg。

设置方式：
echarts：echarts.init(document.getElementById('main'),{ renderer: 'svg' });

上述改动部署后在15k显示器上观察是否还会出现屏闪，还是有一定概率。最终查阅了相关chrome相关设置，修改了chrome:flags中几个配置项。

- GPU rasterization   disable
- WebGL Draft Extensions   enable
- Zero-copy rasterizer   disable

## 2026-02-02更新

现场反馈还是会出现屏闪，询问情况后好像是因为新需求页面中嵌入了其他项目的大屏页面，可能没有按优化改动页面。但是现场技术人员，写了一段脚本，闪屏问题暂时没有了。

脚本如下：
```bat
start "" "C:\Program Files\Google\Chrome\Application\chrome.exe" --max-webgl-image-size=32768 --max-active-webgl-contexts=64 --enable-features=Vulkan,UseSkiaRenderer --disable-gpu-driver-workarounds --ignore-gpu-blacklist --enable-gpu-rasterization --enable-zero-copy --force-high-performance-gpu --disable-features=UseOzonePlatform --d3d11-max-texture-width=32768 --d3d11-max-texture-height=32768 --enable-webgl-developer-extensions --disable-features=VizDisplayCompositor --use-angle=gl --disable-direct-composition-layers --num-raster-threads=8 --gpu-no-context-lost
```

这段脚本中发现有些设置和之前修改的几个设置有冲突，但是没有出现闪屏，可能冲突的设置并没有起作用。关键的是几个其他，查询grok后，grok给的答案：

**总结：这个脚本最有效的几招组合（针对超大屏Canvas闪白）**
- 把D3D11纹理上限拉到32768（--d3d11-max-texture-*）
- WebGL纹理上限也拉到32768（--max-webgl-image-size）
- 把ANGLE后端从D3D11改成OpenGL（--use-angle=gl）→这是很多超大屏用户最终绕过D3D11 bug的常用手段
- 禁用一些新合成器/强制旧路径（--disable-features=VizDisplayCompositor + --disable-direct-composition-layers）
- 强制高性能GPU + 忽略黑名单 + 禁用workaround

建议的精简版（Windows最常见有效组合）

```bat
start "" "C:\Program Files\Google\Chrome\Application\chrome.exe" ^
  --use-angle=gl ^
  --d3d11-max-texture-width=32768 ^
  --d3d11-max-texture-height=32768 ^
  --max-webgl-image-size=32768 ^
  --ignore-gpu-blacklist ^
  --disable-gpu-driver-workarounds ^
  --force-high-performance-gpu ^
  --disable-features=VizDisplayCompositor ^
  --disable-direct-composition-layers
```
